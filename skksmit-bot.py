import os
from aiogram import Bot, Dispatcher
from aiogram.fsm.storage.memory import MemoryStorage
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.context import FSMContext
from aiogram.types import Message, KeyboardButton
from aiogram.filters import Command
from aiogram.utils.keyboard import ReplyKeyboardBuilder

# –¢–æ–∫–µ–Ω –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–∞ Heroku ‚Äî config vars)
TOKEN = os.getenv("BOT_TOKEN")
if not TOKEN:
    print("ERROR: BOT_TOKEN not set!")
    exit(1)

bot = Bot(token=TOKEN)
storage = MemoryStorage()
dp = Dispatcher(storage=storage)

class Form(StatesGroup):
    specialty = State()
    subject = State()
    semester = State()

specialties = [
    "–°–µ—Å—Ç—Ä–∏–Ω—Å–∫–æ–µ –¥–µ–ª–æ",
    "–§–∞—Ä–º–∞—Ü–∏—è",
    "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∞—è",
    "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è –æ—Ä—Ç–æ–ø–µ–¥–∏—á–µ—Å–∫–∞—è",
    "–≠–∫–æ–Ω–æ–º–∏–∫–∞ –∏ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–π —É—á–µ—Ç –ø–æ –æ—Ç—Ä–∞—Å–ª—è–º",
    "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Ñ—Ç—è–Ω—ã—Ö –∏ –≥–∞–∑–æ–≤—ã—Ö –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–π",
    "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ",
    "–ü—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
    "–ü—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏–µ –≤ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–∞—Ö",
    "–≠–ª–µ–∫—Ç—Ä–æ–º–µ—Ö–∞–Ω–∏–∫ –ø–æ –ª–∏—Ñ—Ç–∞–º"
]

subjects_by_specialty = {
    "–°–µ—Å—Ç—Ä–∏–Ω—Å–∫–æ–µ –¥–µ–ª–æ": [
        "–ö–£–ì", "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤ –ü–î", "–ê–Ω–∞—Ç–æ–º–∏—è –∏ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—è —á–µ–ª–æ–≤–µ–∫–∞",
        "–û—Å–Ω–æ–≤—ã –ª–∞—Ç–∏–Ω—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ —Å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–µ–π", "–û—Å–Ω–æ–≤—ã –ø–∞—Ç–æ–ª–æ–≥–∏–∏", "–û—Å–Ω–æ–≤—ã –º–∏–∫—Ä–æ–±–∏–æ–ª–æ–≥–∏–∏ –∏ –∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",
        "–ì–µ–Ω–µ—Ç–∏–∫–∞", "–§–∞—Ä–º–∞–∫–æ–ª–æ–≥–∏—è", "–û—Å–Ω–æ–≤—ã –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞", "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –æ–±—â–µ–Ω–∏—è", "–ì–∏–≥–∏–µ–Ω–∞ —Å —ç–∫–æ–ª–æ–≥–∏–µ–π —á–µ–ª–æ–≤–µ–∫–∞",
        "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞", "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫", "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–ò—Å—Ç–æ—Ä–∏—è", "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞", "–û–ë–ñ",
        "–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ", "–§–∏–∑–∏–∫–∞", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–•–∏–º–∏—è", "–ë–∏–æ–ª–æ–≥–∏—è", "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è", "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏"
    ],
    "–§–∞—Ä–º–∞—Ü–∏—è": [],
    "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∞—è": [
        "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫ –∏ –∫—É–ª—å—Ç—É—Ä–∞ —Ä–µ—á–∏", "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫", "–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
        "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ –∏ –ò–ö–¢", "–ò—Å—Ç–æ—Ä–∏—è", "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏", "–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ", "–§–∏–∑–∏–∫–∞", "–•–∏–º–∏—è",
        "–ë–∏–æ–ª–æ–≥–∏—è", "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞", "–û—Å–Ω–æ–≤—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∂–∏–∑–Ω–µ–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏", "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–µ–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
        "–û—Å–Ω–æ–≤—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏", "–û—Å–Ω–æ–≤—ã —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏", "–ê–Ω–∞—Ç–æ–º–∏—è –∏ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—è —á–µ–ª–æ–≤–µ–∫–∞",
        "–ê–Ω–∞—Ç–æ–º–∏—è –∏ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—è —á–µ–ª–æ–≤–µ–∫–∞ —Å –∫—É—Ä—Å–æ–º –±–∏–æ–º–µ—Ö–∞–Ω–∏–∫–∏ –∑—É–±–æ—á–µ–ª—é—Å—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã",
        "–û—Å–Ω–æ–≤—ã –ª–∞—Ç–∏–Ω—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ —Å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–µ–π", "–ö–ª–∏–Ω–∏—á–µ—Å–∫–æ–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤–µ–¥–µ–Ω–∏–µ",
        "–û—Å–Ω–æ–≤—ã –º–∏–∫—Ä–æ–±–∏–æ–ª–æ–≥–∏–∏ –∏ –∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å", "–ì–∏–≥–∏–µ–Ω–∞ —Å —ç–∫–æ–ª–æ–≥–∏–µ–π —á–µ–ª–æ–≤–µ–∫–∞",
        "–ó—É–±–æ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤–µ–¥–µ–Ω–∏–µ", "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –æ–±—â–µ–Ω–∏—è", "–û–±—â–∞—è –∏ –Ω–µ–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∞—è —Ö–∏–º–∏—è",
        "–û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∞—è —Ö–∏–º–∏—è", "–§–∞—Ä–º–∞–∫–æ–ª–æ–≥–∏—è", "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è –∏ –∏—Ö –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞",
        "–ì–∏–≥–∏–µ–Ω–∞ –ø–æ–ª–æ—Å—Ç–∏ —Ä—Ç–∞", "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏–µ", "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –∏ –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ",
        "–û–∫–∞–∑–∞–Ω–∏–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏ –≤ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ"
    ],
    "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è –æ—Ä—Ç–æ–ø–µ–¥–∏—á–µ—Å–∫–∞—è": [
        "–ê–Ω–∞—Ç–æ–º–∏—è –∏ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—è —á–µ–ª–æ–≤–µ–∫–∞", "–û—Å–Ω–æ–≤—ã –º–∏–∫—Ä–æ–±–∏–æ–ª–æ–≥–∏–∏ –∏ –∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",
        "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –æ–±—â–µ–Ω–∏—è", "–û–±—â–∞—è –∏ –Ω–µ–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∞—è —Ö–∏–º–∏—è", "–û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∞—è —Ö–∏–º–∏—è",
        "–§–∞—Ä–º–∞–∫–æ–ª–æ–≥–∏—è", "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–µ–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
    ],
    "–≠–∫–æ–Ω–æ–º–∏–∫–∞ –∏ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–π —É—á–µ—Ç –ø–æ –æ—Ç—Ä–∞—Å–ª—è–º": [
        "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã –ø—Ä–∏—Ä–æ–¥–æ–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è", "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫", "–ò—Å—Ç–æ—Ä–∏—è",
        "–û—Å–Ω–æ–≤—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏", "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –æ–±—â–µ–Ω–∏—è", "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫ –∏ –∫—É–ª—å—Ç—É—Ä–∞ —Ä–µ—á–∏", "–†—ã–Ω–æ–∫ —Ç—Ä—É–¥–∞",
        "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞", "–≠–∫–æ–Ω–æ–º–∏–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏", "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "–ú–µ–Ω–µ–¥–∂–º–µ–Ω—Ç",
        "–ü—Ä–∞–≤–æ–≤–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –≤ –ü–î", "–§–∏–Ω–∞–Ω—Å—ã –∏ –∫—Ä–µ–¥–∏—Ç—ã", "–ù–∞–ª–æ–≥–∏ –∏ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏–µ",
        "–û—Å–Ω–æ–≤—ã –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–æ–≥–æ —É—á–µ—Ç–∞", "–î–û–£", "–ê—É–¥–∏—Ç", "–ë–ñ–î", "–û—Å–Ω–æ–≤—ã –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –¥–µ–ª–∞",
        "–û—Å–Ω–æ–≤—ã —Å—Ç—Ä–∞—Ö–æ–≤–æ–≥–æ –¥–µ–ª–∞", "–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è —Ç–µ–æ—Ä–∏—è", "–û—Å–Ω–æ–≤—ã –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞",
        "–ê–Ω–∞–ª–∏–∑ –§–ó–î", "–ê—Å—Ç—Ä–æ–Ω–æ–º–∏—è", "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞", "–û–ë–ñ", "–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ",
        "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", "–≠–∫–æ–Ω–æ–º–∏–∫–∞", "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –ü–î"
    ],
    "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Ñ—Ç—è–Ω—ã—Ö –∏ –≥–∞–∑–æ–≤—ã—Ö –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–π": [
        "–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –≥–µ–æ–ª–æ–≥–∏—è, –≥–æ—Ä–Ω–æ–µ –¥–µ–ª–æ", "–û—Å–Ω–æ–≤—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏", "–ò—Å—Ç–æ—Ä–∏—è", "–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫",
        "–ò–Ω–∂–µ–Ω–µ—Ä–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞", "–ì–µ–æ–ª–æ–≥–∏—è", "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞", "–û—Å–Ω–æ–≤—ã —ç–∫–æ–Ω–æ–º–∏–∫–∏",
        "–ë—É—Ä–µ–Ω–∏–µ –Ω–µ—Ñ—Ç—è–Ω—ã—Ö –∏ –≥–∞–∑–æ–≤—ã—Ö —Å–∫–≤–∞–∂–∏–Ω", "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
        "–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ", "–û–ë–ñ", "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞", "–ê—Å—Ç—Ä–æ–Ω–æ–º–∏—è", "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è",
        "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–§–∏–∑–∏–∫–∞", "–ë–∏–æ–ª–æ–≥–∏—è", "–•–∏–º–∏—è",
        "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–ª–ª–µ–∫—Ç–∏–≤–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π",
        "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç –ø–æ –¥–æ–±—ã—á–µ —É–≥–ª–µ–≤–æ–¥–æ—Ä–æ–¥–Ω–æ–≥–æ —Å—ã—Ä—å—è", "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏"
    ],
    "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ": [
        "–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è", "–≠–ª–µ–º–µ–Ω—Ç—ã –≤—ã—Å—à–µ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏",
        "–î–∏—Å–∫—Ä–µ—Ç–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏",
        "–¢–µ–æ—Ä–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –∏ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "–û—Å–Ω–æ–≤—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏",
        "–ò—Å—Ç–æ—Ä–∏—è", "–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫ –≤ –ü–î", "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞", "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –æ–±—â–µ–Ω–∏—è",
        "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞", "–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ",
        "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è", "–•–∏–º–∏—è", "–ë–∏–æ–ª–æ–≥–∏—è", "–û–ë–ñ", "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–§–∏–∑–∏–∫–∞",
        "–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ —Å—Ä–µ–¥—ã", "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤",
        "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "–û—Å–Ω–æ–≤—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è",
        "–ü—Ä–∞–≤–æ–≤–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏", "–ë–ñ–î",
        "–û—Å–Ω–æ–≤—ã —ç–∫–æ–Ω–æ–º–∏–∫–∏ –∏ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞", "–û—Å–Ω–æ–≤—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö"
    ],
    "–ü—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å": [
        "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–û—Å–Ω–æ–≤—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏", "–ò—Å—Ç–æ—Ä–∏—è", "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫", "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞",
        "–ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–Ω–æ–µ –ø—Ä–∞–≤–æ", "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–∞–≤–æ", "–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–µ –ø—Ä–∞–≤–æ –∏ –ø—Ä–æ—Ü–µ—Å—Å",
        "–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ø—Ä–∞–≤–æ", "–ö—Ä–∏–º–∏–Ω–∞–ª–æ–≥–∏—è –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π", "–£–≥–æ–ª–æ–≤–Ω–æ–µ –ø—Ä–∞–≤–æ",
        "–£–≥–æ–ª–æ–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å", "–ö—Ä–∏–º–∏–Ω–∞–ª–∏—Å—Ç–∏–∫–∞", "–ë–ñ–î", "–¢—Ä—É–¥–æ–≤–æ–µ –ø—Ä–∞–≤–æ", "–§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –ø—Ä–∞–≤–æ",
        "–ù–∞–ª–æ–≥–æ–≤–æ–µ –ø—Ä–∞–≤–æ", "–°–µ–º–µ–π–Ω–æ–µ –ø—Ä–∞–≤–æ", "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–∞–≤–æ",
        "–≠–∫–æ–Ω–æ–º–∏–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏", "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è", "–ê—Å—Ç—Ä–æ–Ω–æ–º–∏—è", "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è",
        "–ï—Å—Ç–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ", "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞", "–û–ë–ñ", "–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ",
        "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", "–≠–∫–æ–ª–æ–≥–∏—è", "–ú–•–ö"
    ],
    "–ü—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏–µ –≤ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–∞—Ö": [
        "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫ –∏ –∫—É–ª—å—Ç—É—Ä–∞ —Ä–µ—á–∏", "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫ —Å –º–µ—Ç–æ–¥–∏–∫–æ–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è",
        "–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ –∏ –ò–ö–¢", "–ò—Å—Ç–æ—Ä–∏—è",
        "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏", "–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ", "–§–∏–∑–∏–∫–∞", "–•–∏–º–∏—è", "–ë–∏–æ–ª–æ–≥–∏—è", "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞",
        "–û—Å–Ω–æ–≤—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∂–∏–∑–Ω–µ–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏", "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–µ–¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
        "–û—Å–Ω–æ–≤—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏", "–û—Å–Ω–æ–≤—ã —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏", "–û—Å–Ω–æ–≤—ã –ø–µ–¥–∞–≥–æ–≥–∏–∫–∏",
        "–í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –∞–Ω–∞—Ç–æ–º–∏—è, —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—è –∏ –≥–∏–≥–∏–µ–Ω–∞", "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –æ–±—â–µ–Ω–∏—è"
    ],
    "–≠–ª–µ–∫—Ç—Ä–æ–º–µ—Ö–∞–Ω–∏–∫ –ø–æ –ª–∏—Ñ—Ç–∞–º": [
        "–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –∫ —Ä–∞–±–æ—á–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ", "–£—á–µ–±–Ω—ã–π –ø–ª–∞–Ω", "–≠–ª–µ–∫—Ç—Ä–æ–º–µ—Ö–∞–Ω–∏–∫ –ø–æ –ª–∏—Ñ—Ç–∞–º"
    ]
}

# –û—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º (–ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –ì–µ–æ–≥—Ä–∞—Ñ–∏—è)
subject_links = {
    "–≥–µ–æ–≥—Ä–∞—Ñ–∏—è": "https://clck.ru/3RXPxv",  # ‚Üê —Ç–≤–æ—è —Ä–µ–∞–ª—å–Ω–∞—è –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞
    # –î–æ–±–∞–≤–ª—è–π —Å—é–¥–∞ –Ω–æ–≤—ã–µ –ø–æ –º–µ—Ä–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è, –ø—Ä–∏–º–µ—Ä:
    # "—Ñ–∞—Ä–º–∞–∫–æ–ª–æ–≥–∏—è": "https://clck.ru/–Ω–æ–≤–∞—è_—Å—Å—ã–ª–∫–∞",
}

# –ë–∞–∑–æ–≤–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–∞–ø–∫—É –°–ö–ö–°–ú–∏–¢ –≤ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–µ (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é!)
base_link = "https://disk.yandex.ru/d/–¢–í–û–Ø_–û–ë–©–ê–Ø_–°–°–´–õ–ö–ê_–°–ö–ö–°–ú–∏–¢"  # ‚Üê –∑–¥–µ—Å—å –≤—Å—Ç–∞–≤—å —Å–≤–æ—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–∞–ø–∫—É –°–ö–ö–°–ú–∏–¢

def specialties_kb():
    b = ReplyKeyboardBuilder()
    for s in specialties:
        b.add(KeyboardButton(text=s))
    b.add(KeyboardButton(text="–ù–∞–∑–∞–¥"))
    b.adjust(2)
    return b.as_markup(resize_keyboard=True)

def subjects_kb(spec):
    b = ReplyKeyboardBuilder()
    for subj in subjects_by_specialty.get(spec, []):
        b.add(KeyboardButton(text=subj))
    b.add(KeyboardButton(text="–ù–∞–∑–∞–¥"))
    b.adjust(2)
    return b.as_markup(resize_keyboard=True)

def semesters_kb():
    b = ReplyKeyboardBuilder()
    for i in range(1, 9):
        b.add(KeyboardButton(text=f"{i} —Å–µ–º–µ—Å—Ç—Ä"))
    b.add(KeyboardButton(text="–ù–∞–∑–∞–¥"))
    b.adjust(4)
    return b.as_markup(resize_keyboard=True)

@dp.message(Command("start"))
async def start(message: Message, state: FSMContext):
    await message.answer("–ü—Ä–∏–≤–µ—Ç! üëã\n–í—ã–±–µ—Ä–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:", reply_markup=specialties_kb())
    await state.set_state(Form.specialty)

@dp.message(Form.specialty)
async def specialty_handler(message: Message, state: FSMContext):
    text = message.text.strip()
    if text == "–ù–∞–∑–∞–¥":
        await state.clear()
        await start(message, state)
        return
    if text not in specialties:
        await message.answer("–í—ã–±–µ—Ä–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –∏–∑ –∫–Ω–æ–ø–æ–∫")
        return
    await state.update_data(specialty=text)
    subjects = subjects_by_specialty.get(text, [])
    if not subjects:
        await message.answer(f"–î–ª—è ¬´{text}¬ª –ø—Ä–µ–¥–º–µ—Ç—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã üòî\n–ù–∞–ø–∏—à–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.")
        await state.clear()
        return
    await message.answer(f"–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å: <b>{text}</b>\n\n–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç:", reply_markup=subjects_kb(text), parse_mode="HTML")
    await state.set_state(Form.subject)

@dp.message(Form.subject)
async def subject_handler(message: Message, state: FSMContext):
    text = message.text.strip()
    if text == "–ù–∞–∑–∞–¥":
        await state.clear()
        await start(message, state)
        return
    data = await state.get_data()
    spec = data["specialty"]
    if text not in subjects_by_specialty.get(spec, []):
        await message.answer("–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∫–Ω–æ–ø–æ–∫")
        return
    await state.update_data(subject=text)
    await message.answer(f"–ü—Ä–µ–¥–º–µ—Ç: <b>{text}</b>\n\n–í—ã–±–µ—Ä–∏ —Å–µ–º–µ—Å—Ç—Ä:", reply_markup=semesters_kb(), parse_mode="HTML")
    await state.set_state(Form.semester)

@dp.message(Form.semester)
async def semester_handler(message: Message, state: FSMContext):
    text = message.text.strip()
    if text == "–ù–∞–∑–∞–¥":
        data = await state.get_data()
        spec = data.get("specialty")
        await message.answer("–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç:", reply_markup=subjects_kb(spec), parse_mode="HTML")
        await state.set_state(Form.subject)
        return

    sem = text.split()[0]
    data = await state.get_data()
    spec = data["specialty"]
    subject = data["subject"].lower()

    # –¢–≤–æ—è —Ä–µ–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ì–µ–æ–≥—Ä–∞—Ñ–∏—é (1 –∏ 2 —Å–µ–º–µ—Å—Ç—Ä)
    if subject == "–≥–µ–æ–≥—Ä–∞—Ñ–∏—è" and sem in ["1", "2"]:
        link = "https://docs.yandex.ru/docs/view?url=ya-disk-public%3A%2F%2Frhni7PkMi6ZNvvAyJC3Id3fgDCJMARZI6MIwqQKBjj9ZoaBXL4wsvhiHZQd6FDuXq%2FJ6bpmRyOJonT3VoXnDag%3D%3D%3A%2F%D0%93%D0%B5%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%8F%2F%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8%20%D0%93%D0%B5%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%8F%20(1).doc&name=%D0%9B%D0%B5%D0%BA%D1%86%D0%B8%D0%B8%20%D0%93%D0%B5%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%8F%20(1).doc&nosw=1"
    else:
        link = f"{base_link}/{spec}/{data['subject']}/{sem} —Å–µ–º–µ—Å—Ç—Ä"

    await message.answer(
        f"<b>{spec}</b>\n"
        f"<b>{data['subject']}</b>\n"
        f"<b>{sem} —Å–µ–º–µ—Å—Ç—Ä</b>\n\n"
        f"–°—Å—ã–ª–∫–∞ –Ω–∞ –ª–µ–∫—Ü–∏–∏:\n{link}",
        reply_markup=specialties_kb(),
        parse_mode="HTML",
        disable_web_page_preview=True
    )
    await state.clear()

if __name__ == "__main__":
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!")
    dp.run_polling(bot)
